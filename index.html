<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobil PC Fiyat - Ger√ßek ƒ∞kinci El Fiyatlarƒ±</title>
    
    <style>
        /* TASARIM KODLARI */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* HEADER */
        .header { text-align: center; color: white; margin-bottom: 30px; padding: 25px 20px; border-radius: 20px; background: rgba(255, 255, 255, 0.1); }
        .header h1 { font-size: 1.8rem; margin-bottom: 10px; }
        
        /* SEARCH */
        .search-box { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 30px; }
        .search-input { width: 100%; padding: 15px; font-size: 16px; border: 2px solid #ddd; border-radius: 10px; margin-bottom: 15px; }
        .search-btn { background: #2563eb; color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; font-size: 16px; cursor: pointer; }
        
        /* RESULTS */
        .result-card { background: white; padding: 15px; margin: 10px 0; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .result-title { font-weight: bold; font-size: 16px; margin-bottom: 8px; }
        .result-price { color: #2563eb; font-weight: bold; font-size: 20px; }
        .result-source { background: #e5e7eb; padding: 4px 10px; border-radius: 12px; font-size: 12px; display: inline-block; margin: 5px 5px 5px 0; }
        
        /* LOADING */
        .loading { text-align: center; padding: 40px; color: white; display: none; }
        .spinner { width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üñ•Ô∏è Mobil PC Fiyat Asistanƒ±</h1>
            <p>Ger√ßek ikinci el fiyatlar ‚Ä¢ Anlƒ±k g√ºncel</p>
        </div>
        
        <!-- SEARCH BOX -->
        <div class="search-box">
            <input type="text" 
                   class="search-input" 
                   id="searchInput" 
                   placeholder="RTX 3060, Ryzen 5, 16GB RAM..."
                   value="RTX 3060">
            
            <button class="search-btn" onclick="searchProducts()">
                üîç GER√áEK Fƒ∞YATLARI BUL
            </button>
        </div>
        
        <!-- LOADING -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Ger√ßek fiyatlar aranƒ±yor...</p>
        </div>
        
        <!-- RESULTS -->
        <div id="results"></div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // YENƒ∞ PROXY - √áALI≈ûAN
        const PROXY_URL = "https://corsproxy.io/?";
        
        // GER√áEK VERƒ∞ √áEK
        async function searchProducts() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;
            
            // Loading g√∂ster
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').innerHTML = '';
            
            try {
                // DOLAP API'DEN GER√áEK VERƒ∞ √áEK
                const realProducts = await getRealDolapProducts(query);
                
                if (realProducts.length > 0) {
                    // GER√áEK VERƒ∞ VARSA G√ñSTER
                    showResults(realProducts, query, false);
                } else {
                    // GER√áEK VERƒ∞ YOKSA, TRENDYOL'U DENE
                    const trendyolProducts = await getTrendyolProducts(query);
                    if (trendyolProducts.length > 0) {
                        showResults(trendyolProducts, query, false);
                    } else {
                        // Hƒ∞√á GER√áEK VERƒ∞ YOKSA DEMO G√ñSTER
                        showDemoResults(query);
                    }
                }
            } catch (error) {
                console.error('Hata:', error);
                showDemoResults(query);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        // DOLAP API'DEN GER√áEK VERƒ∞ √áEK
        async function getRealDolapProducts(query) {
            try {
                const url = `https://api.dolap.com/v7/products/search?q=${encodeURIComponent(query)}&size=8`;
                const response = await fetch(PROXY_URL + encodeURIComponent(url));
                
                if (!response.ok) return [];
                
                const data = await response.json();
                const products = data.products || [];
                
                return products
                    .filter(p => p.price?.amount > 100)
                    .map(p => ({
                        title: p.title,
                        price: p.price?.amount,
                        location: p.seller?.city || 'T√ºrkiye',
                        source: 'dolap',
                        url: `https://www.dolap.com/urun/${p.slug}`,
                        is_real: true
                    }));
                    
            } catch (error) {
                console.log('Dolap hatasƒ±:', error);
                return [];
            }
        }
        
        // TRENDYOL API'DEN VERƒ∞ √áEK
        async function getTrendyolProducts(query) {
            try {
                const url = `https://public.trendyol.com/discovery-web-searchgw-service/v2/api/infinite-scroll/sr?q=${encodeURIComponent(query)}&pi=5`;
                const response = await fetch(PROXY_URL + encodeURIComponent(url));
                
                if (!response.ok) return [];
                
                const data = await response.json();
                const products = data.result?.products || [];
                
                return products.slice(0, 5).map(p => ({
                    title: p.name,
                    price: p.price?.sellingPrice,
                    location: 'Trendyol',
                    source: 'trendyol',
                    url: `https://www.trendyol.com/${p.url}`,
                    is_real: true
                }));
                    
            } catch (error) {
                console.log('Trendyol hatasƒ±:', error);
                return [];
            }
        }
        
        // DEMO VERƒ∞ G√ñSTER
        function showDemoResults(query) {
            const demoProducts = [
                { title: `${query} - Sahibinden`, price: 2850, location: 'ƒ∞stanbul', source: 'sahibinden', is_real: false },
                { title: `${query} - Dolap`, price: 3100, location: 'Ankara', source: 'dolap', is_real: false },
                { title: `${query} - Letgo`, price: 2750, location: 'ƒ∞zmir', source: 'letgo', is_real: false }
            ];
            
            showResults(demoProducts, query, true);
        }
        
        // SONU√áLARI G√ñSTER
        function showResults(products, query, isDemo) {
            let html = `
                <div style="color: white; text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 12px;">
                    <strong>"${query}"</strong> i√ßin ${products.length} sonu√ß
                    ${isDemo ? '<div style="color: #fbbf24; font-size: 14px; margin-top: 5px;">‚ö†Ô∏è Demo Mod (Ger√ßek veri √ßekilemedi)</div>' : '<div style="color: #10b981; font-size: 14px; margin-top: 5px;">‚úÖ Ger√ßek Veriler</div>'}
                </div>
            `;
            
            products.forEach(product => {
                html += `
                    <div class="result-card">
                        <div class="result-title">${product.title}</div>
                        <div class="result-price">${product.price?.toLocaleString('tr-TR') || 'Fiyat belirtilmemi≈ü'}‚Ç∫</div>
                        <div>
                            <span class="result-source" style="background: ${getSourceColor(product.source)}; color: white;">
                                ${product.source.toUpperCase()}
                            </span>
                            <span style="font-size: 14px; color: #666;">üìç ${product.location}</span>
                        </div>
                        ${product.url !== '#' ? 
                            `<a href="${product.url}" target="_blank" style="display: inline-block; margin-top: 10px; padding: 8px 15px; background: #2563eb; color: white; text-decoration: none; border-radius: 8px; font-size: 14px;">üõí Siteye Git</a>` : 
                            ''
                        }
                    </div>
                `;
            });
            
            document.getElementById('results').innerHTML = html;
        }
        
        // KAYNAK RENGƒ∞
        function getSourceColor(source) {
            const colors = {
                'dolap': '#10b981',
                'sahibinden': '#ef4444',
                'letgo': '#f59e0b',
                'trendyol': '#f97316'
            };
            return colors[source] || '#6b7280';
        }
        
        // SAYFA A√áILINCA OTOMATƒ∞K ARA
        window.onload = function() {
            setTimeout(() => {
                searchProducts();
            }, 500);
        };
        
        // ENTER TU≈ûU ƒ∞LE ARAMA
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchProducts();
            }
        });
    </script>
</body>
</html>
