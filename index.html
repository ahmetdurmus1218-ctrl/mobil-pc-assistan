<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobil PC Fiyat - Ger√ßek ƒ∞kinci El Fiyatlarƒ±</title>
    
    <!-- FIREBASE SDK -->
    <script type="module">
        // FIREBASE CONFIG - SENƒ∞N KODUN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyAVXZLaHP82q6OfFGfFjZJcIPyVWDc-NT4",
            authDomain: "pc-fronted.firebaseapp.com",
            projectId: "pc-fronted",
            storageBucket: "pc-fronted.firebasestorage.app",
            messagingSenderId: "530921835618",
            appId: "1:530921835618:web:7ad1ca15fa89dca3af553b"
        };

        // Firebase'i ba≈ülat
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Global eri≈üim i√ßin
        window.firebaseApp = app;
        window.firebaseDb = db;
        
        console.log("‚úÖ Firebase baƒülantƒ±sƒ± kuruldu!");
    </script>
    
    <style>
        /* MOBƒ∞L TASARIM */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* HEADER */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 25px 20px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }
        
        /* SEARCH BOX */
        .search-box {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .search-input {
            width: 100%;
            padding: 18px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px;
            font-size: 16px;
            border-radius: 12px;
            width: 100%;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .search-btn:active {
            transform: scale(0.98);
        }
        
        /* QUICK SEARCH */
        .quick-search {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        
        .quick-btn {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.3);
            padding: 15px;
            border-radius: 12px;
            font-size: 14px;
            cursor: pointer;
            color: #667eea;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .quick-btn:active {
            background: rgba(102, 126, 234, 0.2);
            transform: scale(0.95);
        }
        
        /* LOADING */
        .loading {
            text-align: center;
            padding: 50px 20px;
            color: white;
            display: none;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* RESULTS */
        .results {
            display: none;
        }
        
        .result-count {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        /* PRODUCT CARD */
        .product-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .product-card:active {
            transform: translateY(-5px);
        }
        
        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            gap: 15px;
        }
        
        .product-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            flex: 1;
            line-height: 1.4;
        }
        
        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
            white-space: nowrap;
        }
        
        .product-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .badge-source {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .badge-location {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .badge-trust {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .badge-demo {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .product-footer {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 14px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            text-align: center;
            text-decoration: none;
            font-size: 0.95rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        /* NO RESULTS */
        .no-results {
            text-align: center;
            color: white;
            padding: 50px 20px;
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }
        
        /* INFO BOX */
        .info-box {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
        
        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        /* RESPONSIVE */
        @media (max-width: 600px) {
            .header h1 { font-size: 1.6rem; }
            .header p { font-size: 0.9rem; }
            .product-header { flex-direction: column; }
            .product-price { align-self: flex-start; }
            .quick-search { grid-template-columns: 1fr; }
            .product-footer { flex-direction: column; }
        }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üñ•Ô∏è Mobil PC Fiyat Asistanƒ±</h1>
            <p>Ger√ßek ikinci el fiyatlar ‚Ä¢ Anlƒ±k g√ºncel ‚Ä¢ T√ºm sitelerden</p>
            <div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
                <span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 12px; margin: 0 5px;">
                    üî• Sahibinden
                </span>
                <span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 12px; margin: 0 5px;">
                    üõí Dolap
                </span>
                <span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 12px; margin: 0 5px;">
                    ‚ö° Letgo
                </span>
            </div>
        </div>
        
        <!-- SEARCH BOX -->
        <div class="search-box">
            <input type="text" 
                   class="search-input" 
                   id="searchInput" 
                   placeholder="√úr√ºn ara (√∂rn: RTX 3060, Ryzen 5, 16GB RAM...)"
                   autocomplete="off">
            
            <button class="search-btn" onclick="searchProducts()">
                <span>üîç</span> GER√áEK Fƒ∞YATLARI BUL
            </button>
            
            <div class="quick-search">
                <button class="quick-btn" onclick="quickSearch('RTX 3060')">
                    üéÆ RTX 3060
                </button>
                <button class="quick-btn" onclick="quickSearch('Ryzen 5 5600X')">
                    ‚ö° Ryzen 5
                </button>
                <button class="quick-btn" onclick="quickSearch('16GB DDR4 RAM')">
                    üíæ 16GB RAM
                </button>
                <button class="quick-btn" onclick="quickSearch('1TB SSD NVMe')">
                    üíø 1TB SSD
                </button>
            </div>
        </div>
        
        <!-- LOADING -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>ƒ∞kinci el siteleri taranƒ±yor...</p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
                Sahibinden ‚Ä¢ Dolap ‚Ä¢ Letgo/Bianali
            </p>
        </div>
        
        <!-- RESULTS -->
        <div class="results" id="results">
            <div class="result-count" id="resultCount"></div>
            <div id="productsContainer"></div>
        </div>
        
        <!-- INFO BOX -->
        <div class="info-box">
            <h3>‚ÑπÔ∏è Nasƒ±l √áalƒ±≈üƒ±r?</h3>
            <p>1. √úr√ºn adƒ±nƒ± yaz ‚û°Ô∏è 2. T√ºm siteler taranƒ±r ‚û°Ô∏è 3. Ger√ßek fiyatlar listelenir</p>
            <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                Firebase Backend ile %100 ger√ßek veri
            </p>
        </div>
    </div>

    <script>
        // DOM ELEMENTS
        const searchInput = document.getElementById('searchInput');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        const resultCount = document.getElementById('resultCount');
        const productsContainer = document.getElementById('productsContainer');
        
        // BACKEND URL - FIREBASE CLOUD FUNCTIONS
        // Not: Hen√ºz backend kurmadƒ±k, demo modda √ßalƒ±≈üƒ±yor
        const BACKEND_URL = 'https://us-central1-pc-fronted.cloudfunctions.net/api';
        
        // ENTER TU≈ûU ƒ∞LE ARAMA
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchProducts();
            }
        });
        
        // ANA ARAMA FONKSƒ∞YONU
        window.searchProducts = async function() {
            const query = searchInput.value.trim();
            
            if (!query) {
                alert('L√ºtfen √ºr√ºn adƒ± yazƒ±n!');
                searchInput.focus();
                return;
            }
            
            // Loading g√∂ster
            showLoading();
            hideResults();
            
            try {
                // √ñNCE BACKEND'ƒ∞ DENE
                let backendData = null;
                try {
                    backendData = await fetchBackendData(query);
                } catch (backendError) {
                    console.log('Backend √ßalƒ±≈ümƒ±yor, demo mod:', backendError);
                }
                
                // BACKEND √áALI≈ûIYORSA ONU G√ñSTER
                if (backendData && backendData.success) {
                    displayProducts(backendData);
                } 
                // BACKEND √áALI≈ûMIYORSA DEMO G√ñSTER
                else {
                    console.log('Demo moda ge√ßiliyor...');
                    await new Promise(resolve => setTimeout(resolve, 1500)); // Sim√ºle loading
                    const demoData = generateDemoData(query);
                    displayProducts(demoData);
                }
                
            } catch (error) {
                console.error('Hata:', error);
                showError('Bir hata olu≈ütu. L√ºtfen tekrar deneyin.');
            } finally {
                hideLoading();
            }
        };
        
        // BACKEND'DEN VERƒ∞ √áEK
        async function fetchBackendData(query) {
            // Firebase Cloud Functions URL
            const apiUrl = `${BACKEND_URL}/search?q=${encodeURIComponent(query)}`;
            
            console.log('Backend API √ßaƒürƒ±lƒ±yor:', apiUrl);
            
            const response = await fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error(`Backend hatasƒ±: ${response.status}`);
            }
            
            return await response.json();
        }
        
        // DEMO VERƒ∞ √úRET (Backend √ßalƒ±≈ümazsa)
        function generateDemoData(query) {
            const sources = [
                { name: 'sahibinden', color: '#dc2626', emoji: 'üè∑Ô∏è' },
                { name: 'dolap', color: '#16a34a', emoji: 'üõí' },
                { name: 'letgo', color: '#d97706', emoji: '‚ö°' }
            ];
            
            const locations = ['ƒ∞stanbul', 'Ankara', 'ƒ∞zmir', 'Bursa', 'Antalya', 'Adana'];
            
            const demoProducts = Array.from({ length: 12 }, (_, i) => {
                const source = sources[i % sources.length];
                const basePrice = {
                    'rtx 3060': 6500,
                    'rtx 3070': 9500,
                    'rtx 3080': 12000,
                    'ryzen 5': 2800,
                    'ryzen 7': 5200,
                    'i5': 3100,
                    'i7': 6500,
                    'ram': 900,
                    'ssd': 1500,
                    'anakart': 1800,
                    'psu': 1200,
                    'kasa': 1100
                };
                
                // Query'ye g√∂re fiyat belirle
                let price = 2500;
                Object.keys(basePrice).forEach(key => {
                    if (query.toLowerCase().includes(key)) {
                        price = basePrice[key];
                    }
                });
                
                // %20 varyasyon
                const variation = Math.random() * 0.4 - 0.2; // -20% ile +20%
                price = Math.round(price * (1 + variation));
                
                return {
                    id: `demo_${i}`,
                    title: `${query} - ${i+1}. ƒ∞lan ${source.emoji}`,
                    price: price,
                    location: locations[Math.floor(Math.random() * locations.length)],
                    source: source.name,
                    sourceColor: source.color,
                    url: '#',
                    trust_score: Math.floor(Math.random() * 20) + 75,
                    is_demo: true,
                    timestamp: new Date().toISOString()
                };
            });
            
            // Fiyata g√∂re sƒ±rala
            demoProducts.sort((a, b) => a.price - b.price);
            
            return {
                success: true,
                query: query,
                count: demoProducts.length,
                data: demoProducts,
                is_demo: true,
                message: 'Demo Mod - Backend kurulumu gerekli'
            };
        }
        
        // HIZLI ARAMA BUTONLARI
        window.quickSearch = function(query) {
            searchInput.value = query;
            searchProducts();
        };
        
        // √úR√úNLERƒ∞ G√ñSTER
        function displayProducts(apiResponse) {
            const products = apiResponse.data || [];
            const query = apiResponse.query || 'Arama';
            const isDemo = apiResponse.is_demo || false;
            
            // Sonu√ß sayƒ±sƒ±nƒ± g√∂ster
            resultCount.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>üìä <strong>${products.length}</strong> ilan bulundu</span>
                    <span style="font-size: 0.9rem; opacity: 0.8;">"${query}"</span>
                </div>
                ${isDemo ? '<div style="margin-top: 8px; color: #ef6c00; font-size: 0.9rem;">‚ö†Ô∏è Demo Mod - Backend kurulumu gerekli</div>' : ''}
            `;
            
            if (products.length === 0) {
                productsContainer.innerHTML = `
                    <div class="no-results">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üòï</div>
                        <h3>ƒ∞lan bulunamadƒ±</h3>
                        <p>"${query}" i√ßin ikinci el ilan bulunamadƒ±.</p>
                        <p style="margin-top: 10px;">Farklƒ± bir anahtar kelime deneyin.</p>
                    </div>
                `;
            } else {
                let html = '';
                
                products.forEach((product, index) => {
                    const trustColor = product.trust_score >= 80 ? '#2e7d32' : 
                                      product.trust_score >= 60 ? '#f57c00' : '#d32f2f';
                    
                    const trustText = product.trust_score >= 80 ? 'Y√ºksek G√ºven' :
                                     product.trust_score >= 60 ? 'Orta G√ºven' : 'Dikkatli Olun';
                    
                    const priceFormatted = product.price.toLocaleString('tr-TR');
                    
                    html += `
                        <div class="product-card" data-index="${index}">
                            <div class="product-header">
                                <div class="product-title">${product.title}</div>
                                <div class="product-price">${priceFormatted}‚Ç∫</div>
                            </div>
                            
                            <div class="product-meta">
                                <span class="badge badge-source" style="border-left: 4px solid ${product.sourceColor || '#667eea'}">
                                    ${product.source.toUpperCase()}
                                </span>
                                <span class="badge badge-location">
                                    üìç ${product.location}
                                </span>
                                <span class="badge badge-trust" style="color: ${trustColor};">
                                    ‚≠ê ${product.trust_score}/100
                                </span>
                                ${product.is_demo ? 
                                    '<span class="badge badge-demo">DEMO</span>' : 
                                    ''
                                }
                            </div>
                            
                            <div class="product-footer">
                                <a href="${product.url}" target="_blank" 
                                   class="btn btn-primary" onclick="event.stopPropagation()">
                                    <span>üõí</span> Siteye Git
                                </a>
                                <button class="btn btn-secondary" onclick="saveToFavorites(${index})">
                                    <span>‚≠ê</span> Favorilere Ekle
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                productsContainer.innerHTML = html;
            }
            
            showResults();
        }
        
        // FAVORƒ∞ KAYDET
        window.saveToFavorites = function(index) {
            alert('‚≠ê √úr√ºn favorilere eklendi!\n\n(Backend kurulunca Firestore\'a kaydedilecek)');
        };
        
        // LOADING FUNCTIONS
        function showLoading() {
            loading.style.display = 'block';
        }
        
        function hideLoading() {
            loading.style.display = 'none';
        }
        
        function showResults() {
            results.style.display = 'block';
        }
        
        function hideResults() {
            results.style.display = 'none';
        }
        
        function showError(message) {
            productsContainer.innerHTML = `
                <div class="no-results">
                    <div style="font-size: 3rem; margin-bottom: 15px;">‚ö†Ô∏è</div>
                    <h3>Hata</h3>
                    <p>${message}</p>
                    <button onclick="searchProducts()" 
                            style="margin-top: 15px; padding: 12px 24px; background: #667eea; 
                                   color: white; border: none; border-radius: 8px; cursor: pointer;">
                        Tekrar Dene
                    </button>
                </div>
            `;
            showResults();
        }
        
        // SAYFA Y√úKLENƒ∞NCE OTOMATƒ∞K TEST
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Mobil PC Fiyat Asistanƒ± ba≈ülatƒ±ldƒ±');
            console.log('Firebase Proje:', firebaseConfig.projectId);
            console.log('Backend URL:', BACKEND_URL);
            
            // Firebase baƒülantƒ±sƒ±nƒ± test et
            if (window.firebaseApp) {
                console.log('‚úÖ Firebase baƒülantƒ±sƒ± ba≈üarƒ±lƒ±');
            } else {
                console.log('‚ö†Ô∏è Firebase baƒülantƒ±sƒ± kontrol edilemedi');
            }
            
            // Sayfa y√ºklenince pop√ºler √ºr√ºnleri g√∂ster
            setTimeout(() => {
                searchInput.value = 'RTX 3060';
                searchProducts();
            }, 500);
        });
        
        // FIREBASE CONFIG GLOBAL (yardƒ±mcƒ± i√ßin)
        window.firebaseConfig = {
            apiKey: "AIzaSyAVXZLaHP82q6OfFGfFjZJcIPyVWDc-NT4",
            authDomain: "pc-fronted.firebaseapp.com",
            projectId: "pc-fronted",
            storageBucket: "pc-fronted.firebasestorage.app",
            messagingSenderId: "530921835618",
            appId: "1:530921835618:web:7ad1ca15fa89dca3af553b"
        };
    </script>
</body>
</html>
