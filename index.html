<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üñ•Ô∏è Mobil PC Fiyat Asistanƒ± - Canlƒ± Fiyatlar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* MOBƒ∞L UYUMLU STƒ∞LLER */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); min-height: 100vh; padding: 20px; color: #333; }

        .container { max-width: 100%; background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 20px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2); }

        /* Ba≈ülƒ±k */
        .header { text-align: center; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid #f0f0f0; }
        .header h1 { color: #2d3436; font-size: 1.8rem; margin-bottom: 8px; }
        .header p { color: #636e72; font-size: 0.95rem; }
        .header .highlight { color: #6a11cb; font-weight: 600; }

        /* Arama Kutusu */
        .search-box { display: flex; margin-bottom: 25px; border-radius: 50px; overflow: hidden; box-shadow: 0 5px 15px rgba(106, 17, 203, 0.2); }
        #searchInput { flex-grow: 1; border: none; padding: 18px 22px; font-size: 16px; outline: none; }
        #searchBtn { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); border: none; color: white; padding: 0 30px; font-weight: bold; font-size: 16px; cursor: pointer; transition: opacity 0.3s; }
        #searchBtn:active { opacity: 0.8; }

        /* Hƒ±zlƒ± Butonlar */
        .quick-searches { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .quick-btn { background: #e3f2fd; border: none; padding: 10px 16px; border-radius: 20px; font-size: 14px; color: #2575fc; cursor: pointer; transition: all 0.3s; }
        .quick-btn:active { background: #bbdefb; transform: scale(0.98); }

        /* Y√ºkleme ve Hata */
        #loading, #errorContainer { text-align: center; padding: 30px; border-radius: 15px; margin: 20px 0; display: none; }
        #loading { background: #fff3e0; color: #e65100; }
        #errorContainer { background: #ffebee; color: #c62828; }

        /* Sekmeler */
        .market-tabs { display: flex; background: #f8f9fa; border-radius: 12px; padding: 5px; margin-bottom: 20px; }
        .tab { flex: 1; text-align: center; padding: 14px 10px; border-radius: 10px; cursor: pointer; font-weight: 500; color: #6c757d; transition: all 0.3s; }
        .tab.active { background: white; color: #6a11cb; font-weight: 600; box-shadow: 0 3px 10px rgba(0,0,0,0.08); }

        /* √úr√ºn Listesi */
        .product-list { display: none; }
        .product-list.active { display: block; }

        .product-card { background: white; border-radius: 15px; padding: 18px; margin-bottom: 15px; border-left: 5px solid #6a11cb; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .product-info { flex-grow: 1; }
        .product-title { font-weight: 600; margin-bottom: 8px; color: #2d3436; font-size: 15px; line-height: 1.3; }
        .product-price { font-size: 1.4rem; font-weight: 700; color: #00b894; margin-bottom: 5px; }
        .product-meta { font-size: 0.8rem; color: #636e72; }
        .product-source { display: inline-block; background: #dfe6e9; padding: 3px 10px; border-radius: 12px; margin-top: 5px; font-size: 0.75rem; }
        .product-link { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); color: white; text-decoration: none; padding: 10px 18px; border-radius: 10px; font-weight: 600; font-size: 14px; white-space: nowrap; margin-left: 15px; transition: opacity 0.3s; }
        .product-link:active { opacity: 0.8; }

        /* Letgo √ñzel Kart */
        .letgo-card { border-left-color: #fdcb6e; background: #fffde7; }
        .letgo-badge { background: #fdcb6e; color: #2d3436; }

        /* Zaman Damgasƒ± */
        #timestamp { text-align: center; margin-top: 25px; font-size: 0.85rem; color: rgba(255, 255, 255, 0.85); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-desktop"></i> Mobil PC Fiyat Asistanƒ±</h1>
            <p>Ger√ßek ikinci el fiyatlar <span class="highlight">canlƒ± olarak</span> listelenir</p>
        </div>

        <!-- Arama Kutusu -->
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="√ñrn: ddr4 8gb 3200mhz, i5 11400f, gtx 1660s..." autocomplete="off">
            <button id="searchBtn"><i class="fas fa-search"></i> ARA</button>
        </div>

        <!-- Hƒ±zlƒ± Arama Butonlarƒ± -->
        <div class="quick-searches">
            <button class="quick-btn" data-search="ddr4 8gb 3200mhz"><i class="fas fa-memory"></i> DDR4 8GB</button>
            <button class="quick-btn" data-search="i5 10.nesil"><i class="fas fa-microchip"></i> ƒ∞5 ƒ∞≈ülemci</button>
            <button class="quick-btn" data-search="rtx 3060"><i class="fas fa-gamepad"></i> RTX 3060</button>
            <button class="quick-btn" data-search="500gb ssd m.2"><i class="fas fa-hdd"></i> 500GB SSD</button>
        </div>

        <!-- Y√ºkleme ve Hata Mesajƒ± -->
        <div id="loading">
            <i class="fas fa-spinner fa-spin fa-2x"></i>
            <p style="margin-top: 15px;">Canlƒ± fiyatlar aranƒ±yor...<br><small>Sahibinden, Dolap, Letgo taranƒ±yor</small></p>
        </div>
        <div id="errorContainer"></div>

        <!-- Sonu√ßlarƒ±n G√∂sterileceƒüi Alan -->
        <div id="resultsSection" style="display:none;">
            <!-- Piyasa Sekmeleri -->
            <div class="market-tabs">
                <div class="tab active" data-market="sahibinden"><i class="fas fa-store"></i> Sahibinden</div>
                <div class="tab" data-market="dolap"><i class="fas fa-shopping-bag"></i> Dolap</div>
                <div class="tab" data-market="letgo"><i class="fas fa-bolt"></i> Letgo (Direkt Link)</div>
            </div>

            <!-- √úr√ºn Listeleri (Her Piyasa ƒ∞√ßin Ayrƒ± Div) -->
            <div id="sahibindenResults" class="product-list active"></div>
            <div id="dolapResults" class="product-list"></div>
            <div id="letgoResults" class="product-list"></div>
        </div>

        <!-- Son G√ºncelleme Zamanƒ± -->
        <div id="timestamp"></div>
    </div>

    <!-- Ana JavaScript Kodlarƒ± -->
    <script>
        // ====== KONFƒ∞G√úRASYON ======
        // BACKEND URL'ƒ∞Nƒ∞ BURAYA YAZ! (Senin Render URL'in)
        const BACKEND_URL = 'https://pc-scraper-backend.onrender.com';

        // ====== DOM ELEMENTLERƒ∞ ======
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const loading = document.getElementById('loading');
        const errorContainer = document.getElementById('errorContainer');
        const resultsSection = document.getElementById('resultsSection');
        const timestampEl = document.getElementById('timestamp');

        // ====== ARAMA FONKSƒ∞YONU (Backend'i Canlƒ± √áaƒüƒ±rƒ±r) ======
        async function performSearch(searchQuery) {
            // UI'ƒ± Temizle ve Y√ºkleme G√∂ster
            loading.style.display = 'block';
            errorContainer.style.display = 'none';
            resultsSection.style.display = 'none';
            clearProductLists();

            try {
                console.log(`üîç Backend'e istek atƒ±lƒ±yor: ${BACKEND_URL}/api/search/${encodeURIComponent(searchQuery)}`);
                
                // BACKEND'ƒ∞NE GET ƒ∞STEƒûƒ∞ AT
                const response = await fetch(`${BACKEND_URL}/api/search/${encodeURIComponent(searchQuery)}`, {
                    // Zaman a≈üƒ±mƒ± (10 saniye)
                    signal: AbortSignal.timeout(10000)
                });

                if (!response.ok) {
                    throw new Error(`Backend hatasƒ± (${response.status}): ${response.statusText}`);
                }

                const data = await response.json();
                console.log('‚úÖ Backend\'den veri alƒ±ndƒ±:', data);

                if (!data.success) {
                    throw new Error(data.error || 'Backend bir hata d√∂nd√º.');
                }

                // GELEN CANLI VERƒ∞Yƒ∞ EKRANA YAZDIR
                displaySearchResults(data);

            } catch (error) {
                console.error('‚ùå Arama sƒ±rasƒ±nda hata:', error);
                showError(`Bir sorun olu≈ütu: <strong>${error.name === 'TimeoutError' ? 'ƒ∞stek zaman a≈üƒ±mƒ±na uƒüradƒ±.' : error.message}</strong><br>L√ºtfen baƒülantƒ±nƒ±zƒ± kontrol edip tekrar deneyin.`);
            } finally {
                loading.style.display = 'none';
            }
        }

        // ====== SONU√áLARI EKRANA BASMA FONKSƒ∞YONU ======
        function displaySearchResults(data) {
            // 1. SAHƒ∞Bƒ∞NDEN SONU√áLARI (En D√º≈ü√ºk Fiyata G√∂re Sƒ±ralƒ±)
            if (data.sahibinden && data.sahibinden.length > 0) {
                // En d√º≈ü√ºk fiyata g√∂re sƒ±rala (backend'den zaten sƒ±ralƒ± geliyor ama emin olmak i√ßin)
                const sortedSahibinden = [...data.sahibinden].sort((a, b) => a.price - b.price);
                displayProductList('sahibinden', sortedSahibinden);
            } else {
                document.getElementById('sahibindenResults').innerHTML = '<div class="product-card"><div class="product-info"><p>Sahibinden\'de ilan bulunamadƒ±.</p></div></div>';
            }

            // 2. DOLAP SONU√áLARI (En D√º≈ü√ºk Fiyata G√∂re Sƒ±ralƒ±)
            if (data.dolap && data.dolap.length > 0) {
                const sortedDolap = [...data.dolap].sort((a, b) => a.price - b.price);
                displayProductList('dolap', sortedDolap);
            } else {
                document.getElementById('dolapResults').innerHTML = '<div class="product-card"><div class="product-info"><p>Dolap\'ta ilan bulunamadƒ±.</p></div></div>';
            }

            // 3. LETGO SONUCU (TEK √úR√úN / Dƒ∞REKT Lƒ∞NK)
            const letgoContainer = document.getElementById('letgoResults');
            if (data.letgo && data.letgo.title) {
                letgoContainer.innerHTML = `
                    <div class="product-card letgo-card">
                        <div class="product-info">
                            <div class="product-title"><i class="fas fa-bolt"></i> ${data.letgo.title}</div>
                            <div class="product-price">${data.letgo.formattedPrice || data.letgo.price + ' TL'}</div>
                            <div class="product-meta">${data.letgo.note || 'Letgo - En uygun tek ilan'}</div>
                            <span class="product-source letgo-badge">LETGO - Dƒ∞REKT Lƒ∞NK</span>
                        </div>
                        <a href="${data.letgo.link}" target="_blank" class="product-link">
                            ƒ∞lana Git <i class="fas fa-external-link-alt"></i>
                        </a>
                    </div>
                `;
            } else {
                letgoContainer.innerHTML = '<div class="product-card"><div class="product-info"><p>Letgo\'da ilan bulunamadƒ±.</p></div></div>';
            }

            // Sonu√ßlarƒ± G√∂ster ve Zamanƒ± Yaz
            resultsSection.style.display = 'block';
            const time = new Date(data.timestamp || new Date()).toLocaleTimeString('tr-TR');
            timestampEl.textContent = `Son canlƒ± veri: ${time}`;
        }

        // ====== Bƒ∞R Pƒ∞YASA ƒ∞√áƒ∞N √úR√úN Lƒ∞STESƒ∞ OLU≈ûTURMA ======
        function displayProductList(marketName, productArray) {
            const container = document.getElementById(`${marketName}Results`);
            let html = '';

            productArray.forEach(product => {
                html += `
                    <div class="product-card">
                        <div class="product-info">
                            <div class="product-title">${product.title}</div>
                            <div class="product-price">${product.formattedPrice || product.price.toLocaleString('tr-TR') + ' TL'}</div>
                            <div class="product-meta">
                                ${product.location ? `<i class="fas fa-map-marker-alt"></i> ${product.location}` : ''}
                                ${product.date ? ` ‚Ä¢ <i class="far fa-clock"></i> ${product.date}` : ''}
                            </div>
                            <span class="product-source">${marketName.toUpperCase()}</span>
                        </div>
                        <a href="${product.link}" target="_blank" class="product-link">
                            ƒ∞lana Git <i class="fas fa-external-link-alt"></i>
                        </a>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // ====== YARDIMCI FONKSƒ∞YONLAR ======
        function showError(message) {
            errorContainer.innerHTML = `<p>${message}</p>`;
            errorContainer.style.display = 'block';
        }
        function clearProductLists() {
            ['sahibinden', 'dolap', 'letgo'].forEach(m => {
                document.getElementById(`${m}Results`).innerHTML = '';
            });
        }

        // ====== SEKME DEƒûƒ∞≈ûTƒ∞RME OLAYI ======
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Aktif sekmeyi deƒüi≈ütir
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                // ƒ∞lgili listeyi g√∂ster
                const market = this.getAttribute('data-market');
                document.querySelectorAll('.product-list').forEach(list => list.classList.remove('active'));
                document.getElementById(`${market}Results`).classList.add('active');
            });
        });

        // ====== OLAY Dƒ∞NLEYƒ∞Cƒ∞LERƒ∞ ======
        // Ana Arama Butonu
        searchBtn.addEventListener('click', () => {
            const query = searchInput.value.trim();
            if (query) performSearch(query);
            else showError('L√ºtfen bir √ºr√ºn adƒ± yazƒ±n.');
        });
        // Enter Tu≈üu ile Arama
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchBtn.click();
            }
        });
        // Hƒ±zlƒ± Arama Butonlarƒ±
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                searchInput.value = this.getAttribute('data-search');
                performSearch(searchInput.value);
            });
        });

        // Sayfa Y√ºklendiƒüinde K√º√ß√ºk Bir Test Yap (ƒ∞steƒüe Baƒülƒ±)
        window.addEventListener('load', () => {
            console.log('üöÄ Mobil PC Fiyat Asistanƒ± hazƒ±r. Backend:', BACKEND_URL);
            // √ñnizleme i√ßin input'a √∂rnek yaz (opsiyonel)
            // searchInput.value = 'ddr4 8gb ram';
        });

        // AbortController i√ßin Timeout polyfill
        if (!AbortSignal.timeout) {
            AbortSignal.timeout = function(ms) {
                const controller = new AbortController();
                setTimeout(() => controller.abort(new DOMException('TimeoutError', 'TimeoutError')), ms);
                return controller.signal;
            };
        }
    </script>
</body>
</html>
